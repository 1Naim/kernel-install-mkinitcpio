#!/bin/bash

machine_id="$(< /etc/machine-id)"
options="$(< /etc/kernel/cmdline)"

for entry in /boot/loader/entries/*; do
    if [[ "$entry" =~ ^/boot/loader/entries/"$machine_id" ]]; then
        sed -i "s|^options .*|options    $options systemd.machine_id=$machine_id|" "$entry"
    fi
done
