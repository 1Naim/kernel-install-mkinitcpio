#!/bin/bash


is_readable() {
    file="${1}"

    if [ ! -r "$file" ]; then
        echo "Unable to read $file. Does the file exist?"
        exit
    fi
}

is_readable /etc/machine-id
is_readable /etc/kernel/cmdline

machine_id="$(< /etc/machine-id)"
options="$(< /etc/kernel/cmdline)"

for entry in /boot/loader/entries/*; do
    if [[ "$entry" =~ ^/boot/loader/entries/"$machine_id" ]]; then
        sed -i "s|^options .*|options    $options systemd.machine_id=$machine_id|" "$entry"
    fi
done
